---
title: "Data Análisis con No Detectados"
subtitle: "Límites Reportados y Detectados"
author: "Ing. A.Otiniano"
institute: "UNI"
date: "`r Sys.Date()`"
format: 
  beamer: 
    #logo: "figura/logo.png"
    aspectratio: 32
    navigation: horizontal
    theme: CambridgeUS   
    # colortheme: lily
    fonttheme: professionalfonts
    highlight: monochrome
    progressbar: true
    toc: true
    incremental: true
    urlcolor: blue
header-includes:
  - \usepackage{eso-pic}  # Required for positioning elements
  - |
    \AddToShipoutPictureFG*{
      \AtPageLowerLeft{
        \put(20,20){\includegraphics[width=2.5cm]{figura/logo.png}} 
      }
    }
---

```{r}
# theme:
# Best themes: AnnArbor, CambridgeUS, Berlin, 
# To check: Antibes, Bergen, Berkeley, Copenhagen, Dresden, Frankfurt, Goettingen, Hannover
# Ilmenau, JuanLesPins, Malmoe, Madrid
# Worst themes: Boadilla, Darmstadt, Luebeck, 
```


## Objetivos 

* Entender el concepto de  **Survival Analysis**.

* Conocer los diferentes **Límites de Reporte**.

* Diferenciar los **Límites de Detección y Cuantificación**.

## No Detectados

¿Qué son los No detectados?

-   Son *data real* - no debe ser eliminada.
-   Data censada - conocida como arriba o debajo del **threshold**.
-   Valores censado por la derecha, la izquierda o por intervalos:
    - censado-derecho: <1          <--- 1
    - censado-izquierdo: >1         ---> 1
    - **intervalo censado (0 a 1)** [0 <---> 1], más usado.

# Breve Historia de Estadistica de Datos Censados

## Trabajos Realizados

:::: {.columns}

::: {.column width="40%"}

* Data censada usada desde los 1950s en estadistica industrial y medicina.

* Los métodos han sido desarrollados para diferentes ramas en geociencias `censored value`.

* Es denominado **Survival Analysis** o **Reliability analysis**.

:::

::: {.column width="60%"}

* La información fue reconocida gracias a Hesel con el libro [Nondetects And Data Analysis 2005](https://www.researchgate.net/publication/264946174_Nondetects_And_Data_Analysis_Statistics_for_Censored_Environmental_Data)

* Existe información de su aplicabilidad en sedimentos de quebrada, aguas y suelos, en roca en mucho menor proporción.
:::

::::

## Libros Importantes

```{r, out.width='100%', fig.align='center', fig.cap='Libros de No Detectados'}
knitr::include_graphics(path="Graficos/AEDND_01_1.PNG")
```

# Límites de Reporte

## Conceptos de Límites de Reporte

Los textos pueden ser usados como indicadores (**no es recomendable**):

```{r}
library(knitr)
df <- data.frame(
  Lab = c("<0.01", "<5.00", "10.00"),
  Conc = c(0.01, 5.00, 10.00),
  Remarcado = c("E,J,<,etc", "<", "Detected,`  `,etc")
)

kable(df)
```

Los números o textos pueden ser usados para diferenciar el LD del LQ, pero el *intervalo de puntos finales* es más apropiado para eso.  

## Conceptos de Límites de cambio

Es considerado un termino **general**, calculado para una variedad de usos y formas.
Existen dos tipos principales de límite de reporte:

  * Límite de detección.
  * Límite de cuantificación.
  
Desviación estándar asumida ser constante.


## Clases

:::: {.columns}
::: {.column width="50%"}
* Límite de Detección (LD): Valores medidos sobre el **threshold** son improbable a resultar desde una concentración de cero real.

* Límite de Cuatificación (LC): **Threshold** sobre cual valores numéricos únicos (más que un intervalo o <LC) son reportados.
:::

::: {.column width="50%"}
```{r, out.height='60%', fig.align='center', fig.cap='LD & LC'}
knitr::include_graphics(path="Graficos/AEDND_01_2.png")
```
:::

::::

## Configurando el Límite de Detección

No es sencillo medir una señal de 0 , por este motivo usamos un ruido alrededor de una solución estándar (**muy baja!**) = desviacion std (*s*), por ende asumimos el ruido alrededor de 0. Actualmente, se toma un modelo de regresión para calcular *s* en función dela concetración.

```{r, out.height='60%', fig.align='center'}
# Set up the plotting area to have 1 row and 2 columns
par(mfrow=c(1, 2))
# First plot: Asumido
distribucion <- rnorm(100000, mean = 0, sd = 1)
dens <- density(distribucion)
plot(dens, main="Asumido")
abline(v = 0, col = "red", lwd = 2)
sd_value <- sd(distribucion)
abline(v = sd_value, col = "blue", lwd = 2, lty = 2)
abline(v = -sd_value, col = "blue", lwd = 2, lty = 2)
# Second plot: Medido
distribucion <- rnorm(100000, mean = 2, sd = 1)
dens <- density(distribucion)
plot(dens, main="Medido")
abline(v = 2, col = "red", lwd = 2)
sd_value <- sd(distribucion)
abline(v = sd_value+2, col = "blue", lwd = 2, lty = 2)
abline(v = -sd_value+2, col = "blue", lwd = 2, lty = 2)
```

## El Nivel Crítico

Se considera que $3.14*s > 0$ debería tener un chance de solo **1%** de realmente originar una concentración de 0, asumiendo una distribución normal.

```{r, out.height='70%', fig.align='center'}
distribucion <- rnorm(100000, mean = 0, sd = 0.4)
dens <- density(distribucion)
plot(dens, main="3.14*s =  Critical Level Lc")
abline(v = 0, col = "red", lwd = 2)
abline(v = 0.78, col = "blue", lwd = 2)
text(0.4, 0.05, "3.14*s", pos = 3, col = "black", cex = 1.5)
arrows(x0=0, y0=0.05, x1=0.7, y1=0.05, col="black", lwd=1)
text(1.2, 0.4, "Lc ~ evita FP", pos = 3, col = "red", cex = 1.5)
text(1.2, 0.1, "Lc ~ 1% chance\n de exceder 0.78", pos = 3, col = "black", cex = 1.5)
# polygon(c(dens$x[dens$x >= 0], 0), c(dens$y[dens$x >= 0], 0),
#         col = rgb(1, 0, 0, alpha = 0.5), border = "red", main = "")
polygon(c(dens$x[dens$x >= 0.78], max(dens$x), 0.78),
        c(dens$y[dens$x >= 0.78], 0, 0),
        col = "black", border = NA)
```

## Concepto primario

Una señal de verdadero cero es improbable a ser medido sobre este treshold (critical level). Evita dalso positivo, pero no falso negativo.

```{r, out.height='60%', fig.align='center', fig.cap='Conceptos de FP y FN'}
knitr::include_graphics(path="Graficos/AEDND_01_3.png")
```

# Formato de puntos finales

## Puntos finales

La primera columna es el límite inferior la segunda es el límite superior.

```{r}
library(knitr)
df <- data.frame(
  Lab = c("<0.01", "<5.00", "10.00"),
  Inicio = c(0, 0.00, 10.00),
  Fin = c(0.01, 5.00, 10.00)
)

kable(df)
```

::: {.incremental}

- Detectados tienen mismo valor en ambas columnas.
- Son generalmente usados por software comerciales para `métodos paramétricos` de data censoriada (**Maximun likelihood**).

:::

## Going to sleep

::: {.nonincremental}

- Eat spaghetti
- Drink wine

:::

# Rstudio demo

## Slide with a pause

content before the pause

. . .

content after the pause


## Not Alone

:::: {.columns align=center totalwidth=8em}

::: {.column width="40%"}
contents...
:::

::: {.column width="60%" align=bottom}
contents...
:::

:::: 


## Nowlone

::::  {.columns align=top .onlytextwidth}

::: {.column width="40%" align=center}
contents...
:::

::: {.column width="60%"}
contents...
:::

:::: 

### Revenue management

#### Definition

Cheese rocks^[especially French cheese]


# Leyendo data